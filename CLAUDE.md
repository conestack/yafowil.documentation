# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

**yafowil.documentation** is the official documentation package for YAFOWIL (Yet Another Form Widget Library). It generates Sphinx documentation for the YAFOWIL form library and all its widget extensions.

This package serves two purposes:
1. **Sphinx extension**: Provides custom directives (`yafowilwidgets`, `yafowilplans`) that auto-generate widget documentation from YAFOWIL's factory introspection
2. **Documentation source**: Contains the reStructuredText documentation files in `docs-source/`

## Common Commands

### Setup and Build

```bash
# Full install (creates venv, checks out source packages, installs dependencies)
make install

# Build documentation
make docs

# Live rebuild with browser auto-refresh
make docs-live

# Check for broken links
make docs-linkcheck
```

### Cleanup

```bash
make clean          # Remove build artifacts
make purge          # Remove everything including sources
make runtime-clean  # Remove .pyc files and caches
```

### Working with Sources

The `mx.ini` configuration checks out all yafowil packages (core + widgets) into `sources/` for documentation generation. To update after changes:

```bash
make sources-dirty && make sources    # Re-checkout sources
make packages-dirty && make packages  # Reinstall packages
```

## Architecture

### Sphinx Extension (`src/yafowil/documentation/`)

- `__init__.py` - Registers Sphinx directives and patches HTMLTranslator to avoid CSS conflicts with Bootstrap
- `sphinxext.py` - Implements `WidgetDoc` and `PlanDoc` directives that introspect `yafowil.base.factory` to auto-generate:
  - Blueprint documentation (from `factory.doc["blueprint"]`)
  - Property tables (from `factory.doc["props"]` and `factory.defaults`)
  - Chain callables (extractors, renderers, preprocessors, builders)
  - Plan/macro definitions (from `factory._macros`)

### Documentation Source (`docs-source/`)

- `conf.py` - Sphinx configuration using `conestack` theme
- `*.rst` - Manual documentation organized as:
  - `quickstart.rst` - Installation and basic usage
  - `concepts.rst` - Core architecture (Widget, RuntimeData, Factory, Chains)
  - `usage.rst` - Detailed usage patterns (validation, persistence, actions)
  - `extend.rst` - Creating custom blueprints with complete example and tests
  - `blueprints.rst` - Auto-generated blueprint reference
  - `plans.rst` - Auto-generated macro reference
  - `integrations.rst` - Framework integration guides
  - `yaml.rst` - YAML form definitions (external include)
  - `resources.rst` - JS/CSS resource management
- Uses `collective.sphinx.includedoc` for including docstrings from code

## Documentation Principles

When editing documentation:

- **Avoid redundancy**: Each concept should be explained in one place only
- **Be concise**: Remove verbose explanations; prefer examples over prose
- **Stay current**: Use modern tooling (pyproject.toml, pip/uv) in examples
- **Focus on common cases**: Preprocessors and builders are rarely needed (only 2 of 63 blueprints use builders, none use custom preprocessors)
- **Include tests**: Document testing patterns for custom blueprints

### Build System

Uses **mxmake/mxdev** (same as parent conestack monorepo):
- `mx.ini` - Defines all yafowil packages to checkout for documentation
- `Makefile` - Generated by mxmake, provides build targets
- Virtual environment created in `venv/` using **uv** package installer

## Key Files

- `mx.ini` - Package checkout configuration (defines which yafowil.* packages to include)
- `docs-source/conf.py` - Sphinx configuration
- `src/yafowil/documentation/sphinxext.py` - Core directive implementations

## Monorepo Context

This package may be developed standalone or within the conestack monorepo at `sources/yafowil.documentation/`. When in the monorepo, the parent CLAUDE.md contains additional guidelines for code quality and testing.
